#!/usr/bin/env perl

use strict;
use warnings;
use v5.14;
use Bake;

# check for a BakeFile and import it if there is one
eval {
    require BakeFile;
    BakeFile->import();
};

# Get all pluggable task classes
my @tasks = Bake->tasks;

# Read in the command
my $task = shift @ARGV;

# parse command
my ($throwaway,$namespace,$method) = $task =~ /
    (
        ([^:]*)     # Not a :
        (?:\:\:?)   # Followed by one or two
    )?              #
    ([^:]*)         # not a :
/x;

# search for a matching namespace
$namespace = Bake->find_namespace($namespace);
# search for a matching command
$method = Bake->create_command($namespace,$method);
die "Cannot Run Task $task\n" unless defined $method;

# Run the code
eval ($method);
# Say any errors;
say $@ if $@;
